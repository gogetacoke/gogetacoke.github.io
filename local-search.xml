<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>第二篇博客文档</title>
    <link href="/2024/04/07/%E7%AC%AC%E4%BA%8C%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%96%87%E6%A1%A3/"/>
    <url>/2024/04/07/%E7%AC%AC%E4%BA%8C%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%96%87%E6%A1%A3/</url>
    
    <content type="html"><![CDATA[<blockquote><p>杂质记录</p></blockquote><span id="more"></span><blockquote><p>你可以期待太阳从东方升起，而风却随心所欲地从四面八方吹来。</p></blockquote><blockquote><p>2024年4月7日  0:14分</p><p>今晚在老家  下着蒙蒙细雨   方便入眠</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>blog</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-docker安装</title>
    <link href="/2024/04/07/1-docker%E5%AE%89%E8%A3%85/"/>
    <url>/2024/04/07/1-docker%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-k8s安装-kubeadm</title>
    <link href="/2024/04/07/1-k8s%E5%AE%89%E8%A3%85-kubeadm/"/>
    <url>/2024/04/07/1-k8s%E5%AE%89%E8%A3%85-kubeadm/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-pxe网络装机</title>
    <link href="/2024/04/07/1-pxe%E7%BD%91%E7%BB%9C%E8%A3%85%E6%9C%BA/"/>
    <url>/2024/04/07/1-pxe%E7%BD%91%E7%BB%9C%E8%A3%85%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>PXE基础网络装机</p></blockquote><span id="more"></span><h1>概述</h1><blockquote><p>网络装机的优势：</p><ul><li>规模化：同时装多台主机</li><li>自动化：装系统、配置各种服务</li><li>远程实现：不需要光盘、U盘等物理安装介质</li></ul><p>开机启动项的基本顺序：系统由上向下去寻找安装系统的方式(匹配即停止)</p><ol><li><p>硬盘</p></li><li><p>光驱设备</p></li><li><p>U盘</p></li><li><p>网卡进行网络引导</p></li></ol><p>没有装系统的裸机只需要网络与PXE服务在同一网络即可</p><p>什么是PXE：</p><ul><li>PXE：Pre-boot eXecution Environment</li><li>预启动执行环境，在操作系统之前运行</li><li>可远程安装</li></ul><p>工作模式：</p><ul><li>PXE client 集成在网卡的启动芯片中</li><li>当计算机引导时，从网卡芯片中把PXE client调入内存执行，获取PX server配置、显示菜单，根据用户选择将远程文件引导程序下载到本机运行</li></ul><p>PXE需要那些服务组件：(可以安装在不同的服务器上，但是建议安装在同一台服务器上)</p><ul><li>DHCP服务，分配IP地址、定位引导程序</li><li>TFTP服务，提供引导程序下载</li><li>FTP服务(或HTTP/NFS)，提供yum安装源</li></ul><p>客户机应具备的条件：</p><ul><li>网卡芯片必须支持PXE协议</li><li>主板支持从网卡启动</li></ul><p>PXE组件过程分析</p><p><img src="https://s2.loli.net/2024/04/07/T21BERpZVdqMIW8.png" alt=""></p></blockquote><h1>配置PXE服务</h1><blockquote><p>前提关闭机器的防火墙与设置selinux</p><p>是一台镜像文件安装的虚拟机(后面需要用到光盘镜像内容)；mount /dev/cdrom挂载到/mydvd  (创建文件夹mydvd)</p><p>配置PXE服务需要配置三个服务才能正常装机</p><ul><li>DHCP服务</li><li>TFTP服务</li><li>FTP服务</li></ul><p>下面将所有服务都安装在搭建的这台PXE服务器上</p></blockquote><h2 id="配置DHCP">配置DHCP</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install dhcp-server</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">vim /etc/dhcp/dhcpd.conf</span><br>subnet 192.168.88.0 netmask 255.255.255.0 {<br>  range 192.168.88.100 192.168.88.200;<br>  option domain-name-servers 8.8.8.8;<br>  option routers 192.168.88.254;<br>  next-server 192.168.88.12; # 指明下一个服务(tftp服务)的地址(建议所有服务都在同一台服务器上)<br>  filename "pxelinux.0"; # 指明去这个服务上找什么文件<br>} <br>systemctl start dhcpd<br></code></pre></td></tr></tbody></table></figure><h2 id="配置TFTP服务">配置TFTP服务</h2><blockquote><p>TFTP服务概述</p><ul><li>小文件传输协议，UDP69端口</li><li>用来传送小文件，不支持认证和复杂FTP操作</li><li>默认资源目录：/var/lib/tftpboot</li><li>就算客户端没有操作系统也能进行数据传输</li></ul></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装服务</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install tftp-server</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">启动服务</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">systemctl start tftp</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">ls</span> /var/lib/tftpboot/</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">生成二进制的引导文件 pxelinux.0</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install syslinux</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">cp</span> /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">部署菜单文件；前提已经将光盘文件挂载到mydvd下面</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建pxlinux.0指定的目录文件(必须一致);此文件为菜单文件引导用户可以装不同的操作系统，类时使用光盘安装linux是弹出界面选择安装install Centos 7</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">mkdir</span> /var/lib/tftpboot/pxelinux.cfg</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拷贝菜单文件进行修改</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">cp</span> /mydvd/isolinux/isolinux.cfg /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拷贝图形菜单的程序文件</span><br><span class="hljs-meta prompt_">]# </span><span class="language-bash"><span class="hljs-built_in">cp</span> /mydvd/isolinux/vesamenu.c32 /var/lib/tftpboot/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拷贝图形菜单背景图(可以自定义，大小限制在256像素以内)</span><br><span class="hljs-meta prompt_">]# </span><span class="language-bash"><span class="hljs-built_in">cp</span> /mydvd/isolinux/splash.png /var/lib/tftpboot/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拷贝启动内核：管理系统谁先启动谁后启动</span><br><span class="hljs-meta prompt_">]# </span><span class="language-bash"><span class="hljs-built_in">cp</span> /mydvd/isolinux/vmlinuz /var/lib/tftpboot/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">拷贝启动内核所需要的驱动程序</span><br><span class="hljs-meta prompt_">]# </span><span class="language-bash"><span class="hljs-built_in">cp</span> /mydvd/isolinux/initrd.img /var/lib/tftpboot/</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改菜单文件内容</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">vim /var/lib/tftpboot/pxelinux.cfg/default</span><br>11 menu title yuanhang  # 装机时的标题名字<br>63 menu default # 在62行下添加一行，设置默认的选择<br>64 append initrd=initrd.img  # 删除64行下所有内容，因为只做一个选项<br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改完毕后:wq! 强制保存退出</span><br></code></pre></td></tr></tbody></table></figure><p><strong>测试能否检测到</strong></p><blockquote><p><strong>KVM操作：</strong></p><ol><li>新建虚拟机-选择手动安装(或选择网络引导或PXE)</li><li>搜索安装的镜像名称(rocky)-选择一对应的系统</li><li>内存大于2G以上(2048)</li><li>一直前进-到第五步</li><li>网络需要选择同PXE服务器同在的网络(必须选择同一网络，不然装不上)</li><li>点击完成</li><li>强制关闭次虚拟机</li><li>在虚拟机详情信息值哦改点击引导选项</li><li>勾选NICxxx</li><li>再次开机</li></ol><p><strong>Vmware操作：</strong></p><ol><li>新建虚拟机</li><li>一直狂点下一步即可</li><li>再内存这里修改2048(2G)</li><li>创建成功后，点击网络适配器，网络选择同PXE服务器一致</li><li>点击vmware上方的编辑-虚拟网络编辑器</li><li>点击更改设置-在上方点击PXE服务所使用的网络-取消勾选使用本地DHCP服务…</li><li>点击确定-应用</li><li>开启虚拟机即可</li></ol></blockquote><blockquote><p>图形菜单参考图：选择的内容、背景图</p></blockquote><p><img src="https://s2.loli.net/2024/04/07/ZwCdIQL7nGJa9rz.png" alt=""></p><blockquote><p>[注]：如果出现PXE timeout时的解决办法</p><p>上方按照centos7来进行配置，如果时Rockylinux这样不行，需要将/mydvd/isolinux/* 所有内容复制到/var/lib/tftpboot</p></blockquote><h2 id="部署FTP服务">部署FTP服务</h2><blockquote><p>将众多的软件包通过FTP服务拷贝到虚拟机上(安装系统的软件包)</p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install vsftpd</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">sed -i <span class="hljs-string">"s,anonymous_enable=YES,anonymous_enable=NO,"</span> /etc/vsftpd/vsftpd.conf</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">mkdir</span> -p /var/ftp/rocky</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">mount /dev/cdrom /var/ftp/rocky</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> vsftpd --now</span><br></code></pre></td></tr></tbody></table></figure><h2 id="kickstart">kickstart</h2><blockquote><p>无人值守/无人应答</p><ul><li>预先提供应答文件，定义好各种安装设置</li><li>免去交互过程，实现全自动化安装</li><li>添加%post脚本，可执行安装后的各种配置</li></ul><p>类似手动安装时需要手动选择硬盘、安装的软件、网络等等</p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">]#</span><span class="language-bash">yum -y install system-config-kickstart</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">system-config-kickstart <span class="hljs-comment"># 启动</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"> 程序中无法选择软件包，需要将本地yum仓库名字更改为：[development]</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">根据需求选择需要操作的模块，保存文件到/root 下为一个ks.cfg文件，移动到/var/ftp下</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">注：使用ftp模式安装软件，指定ftp地址需要指定对</span><br></code></pre></td></tr></tbody></table></figure><h2 id="修改配置文件">修改配置文件</h2><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># 修改default,指定ks的位置</span><br>]<span class="hljs-comment">#vim /var/lib/tftpboot/pxelinux.cfg/default</span><br>65 append initrd=initrd.img  ks=ftp://192.168.88.12/ks.cfg<br></code></pre></td></tr></tbody></table></figure><h2 id="开始安装">开始安装</h2><blockquote><p>新建虚拟机，不选择ISO镜像，需要选择同pxe服务器一样的网卡即可（提前在vmware中的虚拟网络编辑中关闭网络的DHCP服务）</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>pxe</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-ntp服务搭建</title>
    <link href="/2024/04/07/1-ntp%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/04/07/1-ntp%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>时间服务器基础搭建</p></blockquote><span id="more"></span><h1>安包</h1><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> chrony<br></code></pre></td></tr></tbody></table></figure><h1>时间服务器配置</h1><figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">vim</span> /etc/chrony.conf<br><span class="hljs-comment"># 第三行注释</span><br><span class="hljs-comment"># pool 2.pool.ntp.org iburst </span><br><span class="hljs-comment"># 23行修改</span><br><span class="hljs-attribute">allow</span> <span class="hljs-literal">all</span> # 允许所有IP访问<br><span class="hljs-comment"># 26行打开注释</span><br><span class="hljs-attribute">local</span> stratum <span class="hljs-number">10</span> # 使用第<span class="hljs-number">10</span>层时间服务器<br><br><span class="hljs-attribute">systemct</span> start chronyd<br></code></pre></td></tr></tbody></table></figure><h1>调用时间同步服务器</h1><h2 id="安包">安包</h2><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum -y <span class="hljs-keyword">install</span> chrony<br></code></pre></td></tr></tbody></table></figure><h2 id="修改配置文件">修改配置文件</h2><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>chrony.conf<br><br><span class="hljs-comment"># 第三行内容修改</span><br>server 时间服务器IP iburst<br><br>systemctl start chronyd<br></code></pre></td></tr></tbody></table></figure><h2 id="测试">测试</h2><figure class="highlight applescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 修改本机时间</span><br><span class="hljs-built_in">date</span> -s <span class="hljs-string">"2016-1-1"</span><br><span class="hljs-built_in">date</span> <span class="hljs-comment"># 查看是否同步</span><br><span class="hljs-built_in">date</span><br></code></pre></td></tr></tbody></table></figure><h2 id="补充">补充</h2><blockquote><ul><li><code>server</code>语句指定了一个具体的NTP服务器，你需要提供该服务器的确切IP地址。</li><li><code>pool</code>语句指定了一个NTP服务器池，你只需要提供该池的起始地址，系统将从该池中选择可用的服务器进行时间同步。</li></ul></blockquote>]]></content>
    
    
    <categories>
      
      <category>ntp</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-mail邮件服务搭建</title>
    <link href="/2024/04/07/1-mail%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/04/07/1-mail%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<blockquote><p>mail电子邮件服务器</p></blockquote><span id="more"></span><h1>目标</h1><blockquote><p>通过域名解析实现邮件服务器的发送</p></blockquote><h1>电子邮件服务器</h1><h2 id="基本功能">基本功能</h2><blockquote><ul><li>为用户提供电子邮箱存储空间(用户名@邮件域名)</li><li>处理用户发出的邮件传输给收件服务器</li><li>处理用户收到的邮件投递到邮箱</li></ul></blockquote><h2 id="邮件通信的寻址">邮件通信的寻址</h2><blockquote><p>根据收件人的地址找到目标服务器</p><ul><li>邮件相关的DNS设置</li><li>添加相应的MX记录，A记录</li></ul></blockquote><h2 id="搭建DNS服务器">搭建DNS服务器</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">关闭selinux和防火墙</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">setenforce 1</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">vim /etc/selinux/config</span><br>SELINUX=permissive<br><span class="hljs-meta prompt_">]#</span><span class="language-bash">systemctl stio firewalld</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装配置dns服务器</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install <span class="hljs-built_in">bind</span> bind-chroot bind-utils</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改主配置文件</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">vim /etc/named.conf</span><br>options {<br>        directory       "/var/named";<br>};<br><br>zone "example.com" IN {<br>        type master;<br>        file "example.com.zone";<br>};<br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改地址库文件</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">cp</span> -p /var/named/named.localhost /var/named/example.com.zone</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">vim /var/named/example.com.zone</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 1D</span><br>@       IN SOA  @ rname.invalid. (<br>                                        0       ; serial<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      server # 指定解析域名的服务器<br>        MX  10  mail # 声明邮件交换记录；在example.com区域当中专门负责邮件交换的mail；10：代表优先级，以防该域名下存在多个邮件服务器<br>server  A       192.168.88.11 # 服务器IP为<br>mail    A       192.168.88.11 # 指定mail的解析服务器<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">重启服务</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">systemctl restart named</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定本机的域名解析服务器，方便测试</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"nameserver 192.168.88.11"</span> &gt; /etc/resolv.conf</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查询邮件交换服务器是谁</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">host -t MX example.com</span><br>example.com mail is handled by 10 mail.example.com.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用nslookup做邮件服务器的域名解析测试</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">nslookup mail.example.com</span><br>Server:         192.168.88.11<br>Address:        192.168.88.11#53<br><br>Name:   mail.example.com<br>Address: 192.168.88.11<br></code></pre></td></tr></tbody></table></figure><h2 id="搭建邮件服务器">搭建邮件服务器</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">安装主要服务</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install postfix mailx</span><br>118 myorigin = example.com # 指定是那一个域名的邮件服务器；也有自动补全域名后缀功能<br>135 inet_interfaces = all # 允许所有人到我这里来使用邮件服务器；将监听本机所有接口<br>183 mydestination = example.com # 指定目的地(收件人)，如果一封邮件是以example.com结尾的代表我就是这个邮件服务器所负责的邮件，由我来进行处理<br><span class="hljs-meta prompt_">]#</span><span class="language-bash">systemctl restart postfix</span><br></code></pre></td></tr></tbody></table></figure><h2 id="测试">测试</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">编写邮件进行测试;创建两个测试用户</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">useradd yh cx</span><br><span class="hljs-meta prompt_">]# </span><span class="language-bash">mail -s <span class="hljs-string">"邮件主题"</span> -r yh cx <span class="hljs-comment"># 敲击回车输入信息内容；yh为发件人，cx为收件人，由于在配置邮件服务器时配置了自动补全，所以这里不用写@example.com，系统会自动补齐</span></span><br>hahaxixilele<br>. # 输入点结束编写<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看邮件内容</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">mail -u cx</span><br>Heirloom Mail version 12.5 7/5/10.  Type ? for help.<br>"/var/mail/cx": 1 message 1 new<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">N  1 yh@example.com        Mon Mar 11 21:05  18/540   <span class="hljs-string">"test"</span></span><br>&amp; 1 # 输入1 查看该邮件<br>Message  1:<br>From yh@example.com  Mon Mar 11 21:05:52 2024<br>Return-Path: &lt;yh@example.com&gt;<br>X-Original-To: cx<br>Delivered-To: cx@example.com<br>Date: Mon, 11 Mar 2024 21:05:51 +0800<br>From: yh@example.com<br>To: cx@example.com<br>Subject: 邮件主题<br>User-Agent: Heirloom mailx 12.5 7/5/10<br>Content-Type: text/plain; charset=us-ascii<br>Status: R<br><br>hahaxixilele<br><br>&amp; q<br>Held 1 message in /var/mail/cx<br></code></pre></td></tr></tbody></table></figure><blockquote><p>mail -s 发送邮件</p><p>mail -u 查看用户的邮件</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>mail</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-ftp基础服务搭建</title>
    <link href="/2024/04/06/1-ftp%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/04/06/1-ftp%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1>配置一个FTP</h1><span id="more"></span><h2 id="服务端配置">服务端配置</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum -y install vsftpd<br>vim /etc/vsftpd/vsftpd.conf<br>anonymous_enable=YES <span class="hljs-comment"># 允许匿名用户访问</span><br>anon_upload_enable=YES <span class="hljs-comment"># 允许上传文件</span><br><br><span class="hljs-built_in">chmod</span> 777 /var/ftp/  <span class="hljs-comment"># 给予pub所有者权限，初始所有者只有rx没有w写入权限</span><br>systemctl restart vsftpd<br></code></pre></td></tr></tbody></table></figure><h2 id="客户端配置">客户端配置</h2><figure class="highlight elixir"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elixir">yum -y install lftp<br>lftp <span class="hljs-number">192.168</span>.<span class="hljs-number">88.2</span>  <span class="hljs-comment">#进入lftp</span><br>lftp <span class="hljs-number">192.168</span>.<span class="hljs-number">88.2</span><span class="hljs-symbol">:~&gt;ls</span><br>drwxrwxrwx    <span class="hljs-number">2</span> <span class="hljs-number">0</span>        <span class="hljs-number">0</span>               <span class="hljs-number">6</span> <span class="hljs-title class_">Apr</span> <span class="hljs-number">23</span>  <span class="hljs-number">2022</span> pub<br>lftp <span class="hljs-number">192.168</span>.<span class="hljs-number">88.2</span><span class="hljs-symbol">:/&gt;cd</span> put<br>lftp <span class="hljs-number">192.168</span>.<span class="hljs-number">88.2</span><span class="hljs-symbol">:/pub&gt;mput</span> a.txt  <span class="hljs-comment"># 上传文件</span><br><span class="hljs-number">45</span> bytes transferred<br></code></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置失败重连时间、次数</span><br>vim /etc/lftp.conf  <br><span class="hljs-built_in">set</span> net:reconnect-interval-base 0  <span class="hljs-comment"># 倒计时从0开始</span><br><span class="hljs-built_in">set</span> net:max-retrise 1 <span class="hljs-comment"># 错误重试次数</span><br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <categories>
      
      <category>ftp</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-DHCP服务器基本搭建</title>
    <link href="/2024/04/06/1-DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E6%9C%AC%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/04/06/1-DHCP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E6%9C%AC%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1>目标</h1><blockquote><p>实现地址分发</p></blockquote><span id="more"></span><h1>概述</h1><blockquote><p>DHCP （Dynamic Host Configuration Protoocol）</p><p>动态主机配置协议，由IETF组织制定，用来简化主机地址分配管理</p><p>主要分配以下入网参数：</p><ul><li>IP地址 子网掩码 广播地址</li><li>默认网关地址 DNS服务器地址</li></ul></blockquote><h1>原理</h1><blockquote><p>DHCP地址分配的四次会话：</p><ul><li>DISCOVERY &gt; OFFER &gt; REQUEST &gt; ACK<ul><li>DISCOVERY：发现，由客户端进行发起；客户端配置了DHCP后如果该机器没有IP地址，将会发起广播，DHCP服务器有接收广播的能力</li><li>OFFER：由DHCP服务器给出的响应，响应内容包括(IP、dns等等)</li><li>REQUEST：客户端作出回应（客户对此IP是否满意）</li><li>ACK：确认IP是否已经分配给客户端，确认前还会做检查，检查当前IP是否被其余机器所占用</li></ul></li></ul><p>服务端基本概念</p><ul><li>租期：允许客户机租用IP地址的时间期限，单位为秒</li><li>作用域：分配给客户机的IP地址所在的网段</li><li>地址池：用来动态分配的IP地址的范围</li></ul></blockquote><h1>服务安装</h1><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">检查环境信息</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">getenforce <span class="hljs-comment"># 是否为permissive或disable</span></span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf remov -y firewalld <span class="hljs-comment"># 卸载防火墙</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">安装dhcp服务</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install dhcp-server</span><br></code></pre></td></tr></tbody></table></figure><h1>修改配置文件</h1><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">]#</span><span class="language-bash">vim /etc/dhcp.dhcpd.conf</span><br>subnet 192.168.88.0 netmask 255.255.255.0 { # 指定分配的网段、子网掩码(结合本机的IP)<br>  range 192.168.88.100 192.168.88.200; # 指定分配IP地址的范围<br>  option domain-name-servers 8.8.8.8; # 指定域名解析服务器<br><span class="hljs-meta prompt_"># </span><span class="language-bash"> option domain-name <span class="hljs-string">"internal.example.org"</span>; <span class="hljs-comment"># 指定符合此域名的主机才会分配，这里注释不用</span></span><br>  option routers 192.168.88.254; # 指定网关地址<br><span class="hljs-meta prompt_">  # </span><span class="language-bash">option broadcast-address 10.5.5.31; <span class="hljs-comment"># 指定广播地址，按需设置</span></span><br>  default-lease-time 600; # 设置IP租期，默认遵循此设置<br>  max-lease-time 7200;<br>} <br></code></pre></td></tr></tbody></table></figure><blockquote><p>[注]：模板文件所在位置</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">打开/etc/dhcp.dhcpd.conf 会出现以下内容</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># DHCP Server Configuration file.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  see /usr/share/doc/dhcp*/dhcpd.conf.example</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  see dhcpd.conf(5) man page</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"></span><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">或安装dhcp-client出现下面这种情况</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># DHCP Server Configuration file.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  see /usr/share/doc/dhcp-server/dhcpd.conf.example</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">  see dhcpd.conf(5) man page</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"></span><br>"""<br>/usr/share... 都是一样的指定了该文件的模板位置，无需关系，只需要在命令行敲击: r /usr/share.... 即可<br>删除不需要的内容<br>"""<br></code></pre></td></tr></tbody></table></figure></blockquote><h1>服务验证</h1><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">重启生效服务</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">systemctl start dhcpd</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">在同网络下新建一台虚拟机进行测试</span><br><span class="hljs-meta prompt_">]#</span><span class="language-bash">dnf -y install dhcp-client <span class="hljs-comment"># 安装测试工具</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">测试</span><br><span class="hljs-meta prompt_">]# </span><span class="language-bash">dhclient -d eth0</span><br>Internet Systems Consortium DHCP Client 4.3.6<br>Copyright 2004-2017 Internet Systems Consortium.<br>All rights reserved.<br>For info, please visit https://www.isc.org/software/dhcp/<br><br>Listening on LPF/eth0/52:54:00:ef:72:e4<br>Sending on   LPF/eth0/52:54:00:ef:72:e4<br>Sending on   Socket/fallback<br>Created duid "\000\004fi\010\314\036}C\014\213u.\350\256\257\032y".<br>DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 4 (xid=0x2a964f78)<br>DHCPREQUEST on eth0 to 255.255.255.255 port 67 (xid=0x2a964f78)<br>DHCPOFFER from 192.168.88.11<br>DHCPACK from 192.168.88.11 (xid=0x2a964f78)<br>bound to 192.168.88.100 -- renewal in 21277 seconds.<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <categories>
      
      <category>dhcp</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>4-DNS缓存服务器</title>
    <link href="/2024/04/06/4-DNS%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/2024/04/06/4-DNS%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>DNS缓存服务器</p></blockquote><span id="more"></span><h1>原理图</h1><p><img src="https://s2.loli.net/2024/04/06/4Tx2dtyKHcAVCEu.png" alt=""></p><h1>使用的好处</h1><blockquote><ol><li><strong>提高网络访问速度</strong>：<ul><li>当用户或客户端发起域名解析请求时，如果DNS缓存服务器已经保存了该域名对应的IP地址，则可以直接从本地缓存中返回结果，无需再次向上游的DNS服务器进行递归查询。这显著减少了网络延迟和响应时间，使得网页、应用或其他互联网服务加载更快。</li></ul></li><li><strong>降低网络负载与带宽消耗</strong>：<ul><li>缓存可以减少对上游DNS服务器的查询请求次数，减轻DNS服务器集群的压力，同时也降低了因频繁查询带来的网络带宽消耗。</li></ul></li><li><strong>提升稳定性与可用性</strong>：<ul><li>即使在DNS服务器出现故障或网络不稳定的情况下，已缓存的DNS记录仍然可以让客户端继续访问已知的网站和服务，提高了系统的稳定性和可用性。</li></ul></li><li><strong>优化内部网络环境</strong>：<ul><li>在企业内部网络环境中，内部DNS缓存服务器可以加速内部域名的解析，并且对于经常访问的外部站点也可以缓存其解析结果，从而改善内部用户的网络体验。</li></ul></li><li><strong>避免循环查询与重复解析</strong>：<ul><li>对于短时间内反复访问相同域名的用户或设备，本地（如浏览器、操作系统或路由器）的DNS缓存能够避免不必要的重复查询，减少系统资源消耗。</li></ul></li><li><strong>防范DDoS攻击</strong>：<ul><li>DNS缓存服务器可以在一定程度上缓解针对DNS基础设施的大规模分布式拒绝服务（DDoS）攻击，通过分散流量和提供部分防御能力。</li></ul></li><li><strong>数据隐私保护</strong>：<ul><li>用户的DNS查询记录被保留在本地或者公司内部的DNS缓存服务器中，而不是直接发送到第三方或公共DNS服务器，有助于增强数据隐私和安全。</li></ul></li></ol></blockquote><h2 id="服务搭建">服务搭建</h2><h3 id="环境准备">环境准备</h3><blockquote><p>三台机器关闭防火墙，selinux以便测试</p></blockquote><table><thead><tr><th>主机名</th><th></th><th></th></tr></thead><tbody><tr><td>server</td><td>192.168.88.5</td><td>DNS主服务器</td></tr><tr><td>pc1</td><td>192.168.88.6</td><td>DNS缓存服务器</td></tr><tr><td>pc2</td><td>192.168.88.7</td><td>客户机</td></tr></tbody></table><h3 id="服务器搭建">服务器搭建</h3><blockquote><p>基础的环境搭建不再赘述</p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改缓存服务器</span><br>[root@pc1 ~]# vim /etc/named.conf <br>options {<br>        directory       "/var/named";<br>        forwarders { 192.168.88.5; }; # 配置需要转发的dns服务器IP地址<br>};<br>[root@pc1 ~]# systemctl restart named<br></code></pre></td></tr></tbody></table></figure><blockquote><p>pc1做为DNS缓存服务器，可以有单独的地址库文件和zong也可以没有只做一个转发</p></blockquote><h3 id="测试">测试</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@pc2 ~]# nslookup www.coke.cn 192.168.88.6<br>Server:         192.168.88.6<br>Address:        192.168.88.6#53<br><br>Non-authoritative answer:<br>Name:   www.coke.cn<br>Address: 192.168.8.100<br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <categories>
      
      <category>dns</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2-DNS分离解析</title>
    <link href="/2024/04/06/3-DNS%E5%88%86%E7%A6%BB%E8%A7%A3%E6%9E%90/"/>
    <url>/2024/04/06/3-DNS%E5%88%86%E7%A6%BB%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h1>DNS分离解析</h1><span id="more"></span><h2 id="概述">概述</h2><blockquote><p>当客户机的DNS查询请求的时候</p><ul><li>能够区分不同客户机的来源地址</li><li>为不同类别的客户机提供不同的解析结果(IP地址)</li></ul></blockquote><h2 id="服务搭建">服务搭建</h2><h3 id="环境准备">环境准备</h3><blockquote><p>三台机器关闭防火墙，selinux以便测试</p></blockquote><table><thead><tr><th>主机名</th><th>IP</th><th>用途</th></tr></thead><tbody><tr><td>server</td><td>192.168.88.5</td><td>DNS主服务器</td></tr><tr><td>pc1</td><td>192.168.88.6</td><td>客户机</td></tr><tr><td>pc2</td><td>192.168.88.7</td><td>客户机</td></tr></tbody></table><h3 id="搭建基础DNS服务">搭建基础DNS服务</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">软件安装及配置</span><br>[root@server ~]# dnf -y install bind bind-chroot bind-utils<br>[root@server ~]#vim /etc/named.conf<br>options {<br>        directory "/var/named";  # 指定地址库文件所在地<br>};      <br><br>zone "coke.cn" IN { # 指定根域名<br>        type master;<br>        file "coke.cn.zone";<br>}; <br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改地址库文件</span><br>[root@server ~]# cp -p /var/named/{named.localhost,coke.cn.zone} <br>[root@server ~]# vim /var/named/named.cn.zone <br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 1D</span><br>@       IN SOA  @ rname.invalid. (<br>                                        0       ; serial<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      server<br>server  A       192.168.88.5  # 指定域名服务器<br>www     A       192.168.4.100 # 指定www的解析结果<br>[root@server ~]#systemctl restart named<br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定域名服务器</span><br>[root@server ~]#echo nameserver 192.168.88.5 &gt; /etc/resolv.conf <br><span class="hljs-meta prompt_"># </span><span class="language-bash">测试</span><br>[root@server ~]#nslookup www.coke.cn<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">pc1 2 机器都进行安装配置测试</span><br>[root@pc1 ~]#dnf -y install bind-utils<br>[root@server ~]#echo nameserver 192.168.88.5 &gt; /etc/resolv.conf <br>[root@pc1 ~]#nslookup www.coke.cn<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br></code></pre></td></tr></tbody></table></figure><h3 id="分离结构">分离结构</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改配置文件</span><br>[root@server ~]#vim /etc/named.conf<br>options {<br>        directory "/var/named";<br>};<br><br>view  "d1"{<br>        match-clients { 192.168.88.6; }; # 指定符合条件地址访问view；这里可以是一个IP或在一个网段192.168.88.0/24<br>        zone "coke.cn" IN {<br>                type master;<br>                file "coke.cn.zone";<br>        };<br>};<br><br>view  "d2"{<br>        match-clients { any; }; # 在分离结构中必须有一个any；dns解析是从上到下进行匹配<br>        zone "coke.cn" IN {<br>                type master;<br>                file "coke.cn.other";  # 指定客户机从上到下匹配都匹配不成功后访问的地址库文件<br>        };<br>};<br><span class="hljs-meta prompt_"># </span><span class="language-bash">创建新的地址库文件</span><br>[root@server ~]# cp -p /var/named/{coke.cn.zone,coke.cn.other} <br>[root@server ~]# vim /var/named/coke.cn.other <br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 1D</span><br>@       IN SOA  @ rname.invalid. (<br>                                        0       ; serial<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      server<br>server  A       192.168.88.5<br>www     A       1.2.3.4<br>[root@server ~]# systemctl restart named<br></code></pre></td></tr></tbody></table></figure><h3 id="客户机测试">客户机测试</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">192.168.88.5机器测试</span><br>[root@server ~]# nslookup www.coke.cn<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 1.2.3.4<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">192.168.88.6机器测试</span><br>[root@pc1 ~]# nslookup www.coke.cn<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">192.168.88.7机器测试</span><br>[root@pc2 ~]# nslookup www.coke.cn<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 1.2.3.4<br></code></pre></td></tr></tbody></table></figure><h2 id="总结">总结</h2><blockquote><p>分离解析的作用：针对不同客户端解析不同的结果</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>dns</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2-DNS主从搭建</title>
    <link href="/2024/04/06/2-DNS%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA/"/>
    <url>/2024/04/06/2-DNS%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1>主从DNS搭建</h1><span id="more"></span><h2 id="概述">概述</h2><blockquote><p>主域名服务器</p><ul><li>特定DNS区域的官方服务器，具有唯一性</li><li>负责维护该区域内所有的“域名&lt;--&gt;IP地址”记录</li></ul><p>从域名服务器</p><ul><li>也称为辅助域名服务器，可以没有</li><li>其维护的“域名&lt;--&gt;IP地址”记录取决于主域名服务器</li></ul></blockquote><h2 id="服务搭建">服务搭建</h2><h3 id="环境准备">环境准备</h3><blockquote><p>三台机器关闭防火墙，selinux以便测试</p></blockquote><table><thead><tr><th>主机名</th><th></th><th></th></tr></thead><tbody><tr><td>dns-master</td><td>192.168.88.5</td><td>DNS主服务器</td></tr><tr><td>dns-slave</td><td>192.168.88.6</td><td>DNS从服务器</td></tr><tr><td>pc</td><td>192.168.88.7</td><td>客户机</td></tr></tbody></table><h3 id="搭建主服务器">搭建主服务器</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">软件安装及配置</span><br>[root@dns-master ~]# dnf -y install bind bind-chroot bind-utils<br>[root@dns-master ~]#vim /etc/named.conf<br>options {<br>        directory "/var/named";  # 指定地址库文件所在地<br>        allow-transfer { 192.168.88.6; }; # 指定从服务器的IP地址<br>        <br>};      <br><br>zone "coke.cn" IN { # 指定根域名<br>        type master;<br>        file "coke.cn.zone";<br>}; <br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改地址库文件</span><br>[root@dns-master ~]# cp -p /var/named/{named.localhost,coke.cn.zone} <br>[root@dns-master ~]# vim /var/named/named.cn.zone <br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 1D</span><br>@       IN SOA  @ rname.invalid. (<br>                                        0       ; serial<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      server<br>        NSserver2<br>server  A       192.168.88.5  # 指定主域名服务器<br>server2 A192.168.88.6 # 指定从域名服务器<br>www     A       192.168.4.100 # 指定www的解析结果<br>[root@dns-master ~]#systemctl restart named<br><span class="hljs-meta prompt_"># </span><span class="language-bash">指定域名服务器</span><br>[root@dns-master ~]#echo nameserver 192.168.88.5 &gt; /etc/resolv.conf <br><span class="hljs-meta prompt_"># </span><span class="language-bash">测试</span><br>[root@dns-master ~]#nslookup www.coke.cn<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br></code></pre></td></tr></tbody></table></figure><h3 id="搭建从服务器">搭建从服务器</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">装包配置</span><br>[root@dns-slave ~]# dnf -y install bind bind-chroot<br>[root@dns-slave ~]#vim /etc/named.conf<br>options {<br>        directory       "/var/named";<br>};<br><br>zone "coke.cn" IN { # 指定权威域名<br>        type slave; # 指定当前服务器为从服务器<br>        file "coke.cn.slave"; # 指定从主服务器下载下来的地址库文件名称<br>        masters { 192.168.88.5; }; # 指定主服务器<br>        masterfile-format text; # 指定从主服务器同步下来的内容为文本内容；默认为加密内容<br>};<br><span class="hljs-meta prompt_"># </span><span class="language-bash">验证</span><br>[root@dns-slave ~]# systemctl enable named --now<br>[root@dns-slave ~]# ls /var/named/coke.cn.slave <br>/var/named/coke.cn.slave<br>[root@dns-slave ~]# cat /var/named/coke.cn.slave<br><span class="hljs-meta prompt_">$</span><span class="language-bash">ORIGIN .</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 86400      ; 1 day</span><br>coke.cn                 IN SOA  coke.cn. rname.invalid. (<br>                                0          ; serial<br>                                86400      ; refresh (1 day)<br>                                3600       ; retry (1 hour)<br>                                604800     ; expire (1 week)<br>                                10800      ; minimum (3 hours)<br>                                )<br>                        NS      server.coke.cn.<br><span class="hljs-meta prompt_">$</span><span class="language-bash">ORIGIN coke.cn.</span><br>server                  A       192.168.88.5<br>www                     A       192.168.1.100<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">未加上同步内容为文本</span><br>[root@dns-slave ~]#cat /var/named/coke.cn.slave <br>e�m;KQ� cokecn,cokecnrnameinvalidQ�     :�*0/Q� cokecnservercokecn*Q�serverc<br></code></pre></td></tr></tbody></table></figure><h3 id="客户机测试">客户机测试</h3><blockquote><p>手动指定域名服务器</p><p>nslookup 域名 域名服务器地址</p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@pc ~]#dnf -y install bind-utils<br>[root@pc ~]# nslookup www.coke.cn 192.168.88.5<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br><br>[root@pc ~]# nslookup www.coke.cn 192.168.88.6<br>Server:         192.168.88.6<br>Address:        192.168.88.6#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br></code></pre></td></tr></tbody></table></figure><h3 id="主从同步">主从同步</h3><blockquote><p>以上配置完后，主修改内容从还不能进行同步</p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">修改主地址库文件</span><br>[root@dns-master ~]# vim /var/named/coke.cn.zone <br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 1D</span><br>@       IN SOA  @ rname.invalid. (<br>                                   202402240    ; serial # 数据版本号，主从在同步时通过版本号去同步要不要同步数据的更新；通过数据版本号来进行更新，当主的版本号大于从的从就进行更新；数据版本号是以10个数字来组成，一般建议时间年月加第几次修改：2024022401;若需要修改匹配的规则就需要修改一下版本号<br>                                        1D      ; refresh<br>                                        1H      ; retry<br>                                        1W      ; expire<br>                                        3H )    ; minimum<br>        NS      server<br>server  A       192.168.88.5<br>www     A       192.168.2.100<br>[root@dns-master ~]#systemct restart named<br><span class="hljs-meta prompt_"># </span><span class="language-bash">将从的地址库文件删除并重启</span><br>[root@dns-slave ~]#rm -rf /var/named/coke.cn.slave<br>[root@dns-slave ~]#systemctl restart named<br></code></pre></td></tr></tbody></table></figure><blockquote><p>[注]：每次修改的版本号必须大于上一次设置的版本号</p></blockquote><h3 id="主从测试">主从测试</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">未修改版本号测试</span><br>[root@pc ~]# nslookup www.coke.cn 192.168.88.5<br>Server:         192.168.88.5<br>Address:        192.168.88.5#53<br><br>Name:   www.coke.cn<br>Address: 192.168.2.100<br><br>[root@pc ~]# nslookup www.coke.cn 192.168.88.6<br>Server:         192.168.88.6<br>Address:        192.168.88.6#53<br><br>Name:   www.coke.cn<br>Address: 192.168.1.100<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">修改版本号测试</span><br>[root@pc2 ~]# nslookup www.coke.cn 192.168.88.6<br>Server:         192.168.88.6<br>Address:        192.168.88.6#53<br><br>Name:   www.coke.cn<br>Address: 192.168.2.100<br></code></pre></td></tr></tbody></table></figure><h3 id="调优建议">调优建议</h3><blockquote><p>通过上述测试存在的问题：</p><p>从同步主的数据时限过长，久久不能进行同步</p><p>解决办法：</p><ul><li>删除从同步的文件，重启服务</li><li>调整刷新时间</li></ul></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">将从中的刷新时间调短</span><br>[root@dns-slave ~]#vim /var/named/coke.cn.slave <br><span class="hljs-meta prompt_">$</span><span class="language-bash">ORIGIN .</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">TTL 86400      ; 1 day</span><br>coke.cn                 IN SOA  coke.cn. rname.invalid. (<br>                                2024022403 ; serial<br>                                30      ; refresh (1 day) #单位为秒<br>                                3600       ; retry (1 hour)<br>                                604800     ; expire (1 week)<br>                                10800      ; minimum (3 hours)<br>                                )<br>                        NS      server.coke.cn.<br><span class="hljs-meta prompt_">$</span><span class="language-bash">ORIGIN coke.cn.</span><br>server                  A       192.168.88.5<br>www                     A       192.168.6.100<br></code></pre></td></tr></tbody></table></figure><blockquote><p>SOA参数序列解释：</p><ul><li><code>2024022403</code>：序列号（serial number）。每次对区域数据进行更改并成功同步到从属服务器后，这个数字都应该递增。格式通常是YYYYMMDDnn，其中nn是一个版本序号，这样其他DNS服务器可以通过比较自己的序列号与主服务器的序列号来判断是否需要获取新的区域数据。</li><li><code>1D</code>：刷新（refresh）。这是从服务器检查主服务器上是否有区域数据更新的时间间隔，单位为秒。在这个案例中，从服务器每过一天就会向主服务器请求一次区域数据。</li><li><code>1H</code>：重试（retry）。如果从服务器尝试刷新失败，它将在一小时后再次尝试联系主服务器。</li><li><code>1W</code>：过期（expire）。若从服务器连续多次（根据retry设置决定）无法从主服务器获取更新，则认为主服务器失效，从服务器将不再响应对此区域的查询，直到达到这个过期时间（一周）。</li><li><code>3H</code>：最小TTL（minimum）。这是针对该区域所有资源记录的最低有效TTL值。即使某个资源记录的TTL更低，任何DNS服务器也必须至少保留这个值所指定的时间长度的数据。在此例中，即使某个资源记录的TTL小于3小时，解析器也至少需要缓存3小时。</li></ul></blockquote><h3 id="注意">注意</h3><blockquote><p><strong>调短刷新时间存在的潜在缺点：</strong></p><ul><li>增加网络流量：频繁的刷新会导致主从服务器之间的通信更频繁，特别是在大型部署中，可能会增加不必要的网络带宽使用。</li><li>增加主服务器负载：主服务器需要处理更多的区域传输请求，这可能在高并发场景下对主服务器造成额外的压力。</li><li>对于很少更改的区域来说效率不高：如果DNS区域数据非常稳定，不经常变动，则过于频繁的刷新会显得资源利用率较低。</li></ul><p><code>refresh</code>时间间隔设置应当基于业务需求和服务器性能来综合考虑，以平衡实时性与资源消耗。对于要求较高数据一致性的场景，较短的刷新时间是有益的；而对于数据相对静态且对实时性要求不高的环境，保持默认或较长的时间间隔更为合适。</p><p>一般而言，30分钟至几个小时的刷新间隔是常见的配置选择。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>dns</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>1-DNS基本安装使用</title>
    <link href="/2024/04/06/1-DNS%E5%9F%BA%E6%9C%AC%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <url>/2024/04/06/1-DNS%E5%9F%BA%E6%9C%AC%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>DNS基本使用教程</p></blockquote><span id="more"></span><h1>装包</h1><figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">yum -y <span class="hljs-keyword">install </span><span class="hljs-keyword">bind-chroot </span><span class="hljs-keyword">bind </span><span class="hljs-comment"># 牢笼政策  主程序</span><br></code></pre></td></tr></tbody></table></figure><h1>修改配置</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 备份配置文件</span><br><span class="hljs-built_in">cp</span> -p /etc/named.conf /root<br>vim /etc/name.conf<br>options{<br>directory <span class="hljs-string">"/var/named"</span>; <span class="hljs-comment">#定义dns工作目录及地址库存放文件路径</span><br>};<br>zone <span class="hljs-string">"yyh.cn"</span> IN{  <span class="hljs-comment"># 定义负责解析yyh.cn区域的域名</span><br><span class="hljs-built_in">type</span> master; <span class="hljs-comment"># yyh.cn 设置为主区域</span><br>file <span class="hljs-string">"yyh.cn.zone"</span> <span class="hljs-comment"># 指定该区域对应的区域文件及地址库文件名字</span><br>}<br></code></pre></td></tr></tbody></table></figure><figure class="highlight nginx"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">cd</span> /var/named<br>cp -p named.localhost yyh.cn.zone  <span class="hljs-comment"># 拷贝模板，编写地址库文件</span><br>vim /var/named/yyh.cn.zone <span class="hljs-comment"># 编写域名匹配规则</span><br>        NS      server <span class="hljs-comment"># 声明DNS服务器名称为server</span><br>server  A       <span class="hljs-number">192.168.118.135</span> <span class="hljs-comment"># 指明DNS解析服务为此主机</span><br>www     A       <span class="hljs-number">1.1.1.1</span><br>ftp     A       <span class="hljs-number">2.2.2.2</span><br>*       A       <span class="hljs-number">6.6.6.6</span>  <span class="hljs-comment"># 泛域名解析；任何xx.yyh.cn就匹配此主机</span><br>test.cn. A      <span class="hljs-number">7.7.7.7</span> <span class="hljs-comment"># 匹配主域名：yyh.cn</span><br>vsAftp<span class="hljs-comment">#解析记录别名：访问vs.yyh.cn同访问ftp匹配一样</span><br></code></pre></td></tr></tbody></table></figure><h1>测试</h1><h2 id="本机测试">本机测试</h2><figure class="highlight avrasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">yum -<span class="hljs-built_in">y</span> install bind-utils <span class="hljs-meta"># 安装测试工具</span><br>systemctl start named <span class="hljs-meta"># 启动dns服务</span><br>ps aux|grep named <span class="hljs-meta"># 查询进程情况</span><br>nslookup www.yyh.cn<br><br><span class="hljs-symbol">Server:</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-symbol">Address:</span><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-meta">#53</span><br><br><span class="hljs-symbol">Name:</span>www.yyh.cn<br><span class="hljs-symbol">Address:</span> <span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span><br><br></code></pre></td></tr></tbody></table></figure><h2 id="B机器测试">B机器测试</h2><figure class="highlight dts"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dts">yum -y install bind-utils <br>echo nameserver 提供dns服务机器IP &gt; <span class="hljs-keyword">/etc/</span>resolv.conf <span class="hljs-meta"># 指定dns服务机器</span><br><br>nslookup ftp.yyh.cn<br><span class="hljs-symbol">Server:</span><span class="hljs-number">192.168</span><span class="hljs-number">.118</span><span class="hljs-number">.135</span><br><span class="hljs-symbol">Address:</span><span class="hljs-number">192.168</span><span class="hljs-number">.118</span><span class="hljs-number">.135</span><span class="hljs-meta">#53</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">Name:</span>ftp.yyh.cn<br><span class="hljs-symbol">Address:</span> <span class="hljs-number">2.2</span><span class="hljs-number">.2</span><span class="hljs-number">.2</span><br><br></code></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <categories>
      
      <category>dns</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>第一篇博客文档</title>
    <link href="/2024/03/22/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%96%87%E6%A1%A3/"/>
    <url>/2024/03/22/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%E6%96%87%E6%A1%A3/</url>
    
    <content type="html"><![CDATA[<p>这是我的第一篇博客文档，用于测试页面发布是否正常！</p>]]></content>
    
    
    <categories>
      
      <category>blog</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
